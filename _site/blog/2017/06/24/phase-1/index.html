<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title> Phase-1 of GSoC </title> <meta name="description" content="Things I learned during the phase 1 of GSoC"> <meta name="author" content="Rahul Jha"> <meta content='user-scalable=no, width=device-width, initial-scale=1.0' name='viewport'> <meta name="google-site-verification" content="x2EpQdOMz-k9fP8hak9I3COaXhnQ4jNLp2GU4GYQ8jM" /> <link href='//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic|Open+Sans:300italic,700italic,400,700,300' rel='stylesheet' type='text/css'> <link rel="shortcut icon" href="/assets/favicon.png"> <style type="text/css"> /* http://meyerweb.com/eric/tools/css/reset/ v2.0 | 20110126 License: none (public domain) */ html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video { margin: 0; padding: 0; border: 0; font-size: 100%; font: inherit; vertical-align: baseline; } /* HTML5 display-role reset for older browsers */ article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section { display: block; } body { line-height: 1; } ol, ul { list-style: none; } blockquote, q { quotes: none; } blockquote:before, blockquote:after, q:before, q:after { content: ''; content: none; } table { border-collapse: collapse; border-spacing: 0; } .clearfix:after { content: "."; display: block; clear: both; visibility: hidden; line-height: 0; height: 0; } .clearfix { display: inline-block; } html[xmlns] .clearfix { display: block; } * html .clearfix { height: 1%; } @font-face { font-family: 'anonymousregular'; src: url('/assets/fonts/Anonymous-webfont.eot'); src: url('/assets/fonts/Anonymous-webfont.eot?#iefix') format('embedded-opentype'), url('/assets/fonts/Anonymous-webfont.woff') format('woff'), url('/assets/fonts/Anonymous-webfont.ttf') format('truetype'), url('/assets/fonts/Anonymous-webfont.svg#anonymousregular') format('svg'); font-weight: normal; font-style: normal; } body{ font-size: 15px; font-family: 'Droid Serif', serif; color: #545454; line-height: 25px; } #gradient{ height: 5px; background: rgba(237,82,82,0.64); background: -moz-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -webkit-gradient(left top, right top, color-stop(0%, rgba(237,82,82,0.64)), color-stop(20%, rgba(250,21,0,0.65)), color-stop(52%, rgba(237,82,82,0.66)), color-stop(80%, rgba(255,21,0,0.66)), color-stop(100%, rgba(237,82,82,0.67))); background: -webkit-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -o-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -ms-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: linear-gradient(to right, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ed5252', endColorstr='#ed5252', GradientType=1 ); } /* STRUCTURE */ #container{ background-color: #fafafa; } #content{ width: 760px; margin: auto; margin-top: 20px; padding-bottom: 60px; padding-top: 40px; } /* FOOTER */ footer{ padding: 40px 0px; text-align: center; border-top: 1px solid #e6e6e6; font-size: 0.8em; color: #9a9a9a; background-color: #fafafa; } footer a{ color: #9a9a9a; } /* HEADER */ header{ width: 760px; margin: auto; height: 50px; border-bottom: 1px solid #f1f1f1; position: relative; } #more-nav{ font-size: 0.75em; display: inline-block;; position: absolute; top: 0px; font-family: "anonymousregular"; padding-top: 5px; right: 0px; } #more-nav a{ padding: 0px 2px; text-decoration: none; color: #545454; } #more-nav a:hover{ transition: 0s; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } #more-nav .selected{ color: #ed5252; font-weight: bold; } #logo{ font-size: 1.2em; font-family: "anonymousregular"; margin-top: 20px; } #logo *{ text-decoration: none; } #logo1{ color: #999; } #logo2{ font-size: 0.8em; color: #ed5252; } #logo3{ color: #545454; } #logo a:hover{ color: #ed5252; transition-duration: 1s; } /* TEXT STRUCTURE */ h1, h2, h3, h4, h5{ font-family: 'Open Sans', sans-serif; color: #1c1c1c; } h2, h3, h4, h5{ text-transform: capitalize; } a:hover{ color: #ed5252; transition-duration:0.2s; } p a, ul a, .review a{ color: #763232; text-decoration: none; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } p{ text-align: justify; margin-bottom: 20px; } .excerpt p{ margin-bottom: 0px; } .footnote, .sidenote{ margin: 40px 0px; color: #858585; text-align: right; font-size: 0.9em; font-style: italic; } .image_notes{ text-align: center; color: #858585; font-size: 0.9em; margin: -5px 0px 15px 0px; } h1{ font-size: 1.85em; text-align: center; margin: 70px 0px 20px 0px; line-height : 1.5em; } h1 em{ color: #888; font-weight: normal; font-size: 0.8em; } h2{ font-size: 1.75em; margin: 50px 0px 50px 0px; line-height: 1.75em; } h2::before{ content: "#"; color: #ed5252; font-family: "anonymousregular"; display: inline-block; float: left; padding: 3px 10px 0px 0px; font-size: 0.7em; } h3{ font-size: 1.35em; margin-bottom: 20px; } h4{ font-size: 1.2em; margin-bottom: 20px; font-style: italic; } h5{ font-size: 1.3em; margin-bottom: 20px; } h5 *{ color: #545454; } em{ font-style: italic; } strong{ font-weight: bold; } blockquote{ border-left: 3px solid #ddd; color: #888; margin: 0px 0px 20px 40px; font-style: italic; } blockquote p{ margin: 5px 20px !important; } ul{ padding-left: 40px; line-height: 25px; list-style: square; margin-bottom: 20px; } li{ display: list-item; } ol{ padding-left: 40px; line-height: 25px; margin-bottom: 20px; list-style-type: decimal; } /* TAGS */ .home-tag { font-size: 10px; display: inline-block; border: 1px solid #dedede; padding: 2px 2px 1px 2px; border-radius: 2px; line-height: 10px; margin-left: 1px; } .tag-date{ color: #dedede; } .tag-management { border-color: #929aff; color: #929aff; } .tag-programming { border-color: #ff9292; color: #ff9292; } .tag-coaching { border-color: #4ec698; color: #4ec698; } .tag-projectmanagement { border-color: #929aff; color: #929aff; } /* BLOG INDEX */ #all-posts{ margin: 0px auto 10px auto; width: 760px; } .single-post{ border-top: 1px solid #f1f1f1; padding: 40px 0px; float: clear; } .single-post:first-child{ border-top: none !important; } .single-post .date{ color: #cdcdcd; margin-top: 10px; float: right; } .single-post .author{ color: #cdcdcd; float: right; font-size: 0.7em; } .single-post .title{ font-family: 'Open Sans', sans-serif; font-size: 1.6em; margin-bottom: 20px; line-height: 1.6em; position: relative; } .single-post .title a{ color: #545454; text-decoration: none; } .single-post .title a::before{ content: "→"; opacity: 0; font-family: "anonymousregular"; font-size: 0.7em; position: absolute; left: -30px; transition: all .4s ease-in-out; } .single-post .title a:hover::before{ opacity: 1; transition: all .4s ease-in-out; color: #ed5252; } .single-post .title em{ display: none; } .data_table{ border: 1px solid #efefef; font-family: "anonymousregular"; font-size: 12px; margin: auto auto 20px auto; } .data_table tr{ border: 1px solid #efefef; } .data_table th{ background-color: #efefef; } .data_table th, .data_table td{ padding: 2px 5px; } /* BOOKS */ .book-cover-entry{ width: 120px; margin-right: 20px; float: left; font-size: 12px; text-decoration: none !important; } .buy-book{ text-decoration: underline; } .book-cover-entry img{ width: 120px; } .book-cover-entry { background-image: none; } .book-rating .icon { display: inline-block; padding-right: 5px; } .book-rating .top .icon{ color: #1CED00; } .book-rating .good .icon{ color: #82ED00; } .book-rating .medium .icon{ color: #EDD100; } .book-rating .low .icon{ color: #EDAE00; } .book-rating .poor .icon{ color: #ED3B00; } #buy-title{ padding: 0px 0px 25px 0px; } #buy-title span{ font-size: 0.8em !important; color: #cdcdcd; } #buy-popin{ padding: 30px 15px; } .store{ display: block; padding: 15px 5px; text-decoration: none; } .store:hover{ color: #ed5252; } #upcoming-books{ padding-top: 20px; } #upcoming-books img{ height: 90px; margin-right: 10px; border: 1px solid #fff; } #upcoming-books a{ text-decoration: none; } #upcoming-books img:hover{ border: 1px solid #ed5252; } /* BLOG SHOW */ .post{ padding-top: 20px; } p code, li code{ background-color: #efefef; font-family: "Lucida Console", "Courier New", Courier, monospace; padding: 1px 2px; font-size: 13px; } .post img{ border: 1px solid #e6e6e6; padding: 5px; margin: 0px 0px 20px 20px; } .published span{ border-top: 1px solid #e6e6e6; display: inline-block; color: #858585; padding-top: 5px; font-family: 'Open Sans', sans-serif; font-size: 0.9em; padding: 5px 20px 0px 20px; } .published{ text-align: center; margin-bottom: 80px; } #more{ border-top: 1px solid #e6e6e6; margin-top: 40px; padding: 40px 0px; } #more-articles{ margin-bottom: 40px; } .image-wrapper em{ display: block; font-size: 0.8em; margin: -20px 0px 20px 0px; color: #aaa; } .twitter-tweet{ margin: auto; max-width: 420px !important; } #book-review{ border: 1px dashed #dedede; padding: 20px; margin-bottom: 20px; opacity: 0.7; font-style: italic; } /* Music */ .js_play_sound, .js_stop_sound{ display: inline-block; padding: 4px 10px 2px 10px; border: 1px solid #efefef; background-color: #efefef; margin-right: 10px; text-decoration: none; border-radius: 3px; font-family: 'anonymousregular'; font-size: 12px; } .js_play_sound:hover, .js_stop_sound:hover{ background-color: #dedede; } /* Comments */ #comments{ padding-top: 20px; } #show-disqus-arrow{ color: #ed5252; } /* CLEARFIX */ .cf:before, .cf:after { content: " "; /* 1 */ display: table; /* 2 */ } .cf:after { clear: both; } /************************ MOBILE LAYOUT *********************/ @media all and (max-width: 800px) { .home-tag { display: none; } .author{ float: none !important; display: inline; } header{ width: 92%; padding: 4%; height: 75px; position: relative; text-align: center; background-color: #fafafa; } #more-nav{ left: 0px; top: 50px; } #logo{ margin-top: 10px; } #content, #all-posts{ width: 92%; padding: 4%; } .image-wrapper{ width: 100%; } .image-wrapper img, .post div img, .post p img{ max-width: 100% !important; padding: 15px 0px !important; margin: 20px 0px 20px 0px !important; border-right: 0px; border-left: 0px; } .single-post .title{ font-size: 1.4em; } .date{ display: none; } h1{ font-size: 1.7em; width: 94%; padding: 3%; } h2{ font-size: 1.50em; margin: 30px 0px 30px 0px; line-height: 1.75em; } h3{ font-size: 1.30em; } blockquote{ margin: 0px 0px 20px 0px !important; } pre{ margin-left: 0px !important; margin-right: 0px !important; width: 90%; overflow-x: scroll; } code{ width: 100%; font-size: 13px !important; } footer div{ display: inline; } /* Hire me responsive */ #hire ul{ padding-left: 15px; } #talking-img{ width: 100%; } #talking-img img{ width: 100% !important; } #reviews{ border-top: 1px dashed #e6e6e6; padding: 15px 0px 15px 0px; } #references_logo{ padding: 0px 0px 15px 0px; } .review{ width: 100%; margin: 0px 0px 15px 0px; padding: 0px; border-bottom: 1px dashed #e6e6e6; } #references_logo img, #references_logo .minor{ width: 22%; float: left; margin: 15px 2% 15px 0px; } .data_table th, .data_table td{ font-size: 8px; padding: 0px; border: 1px solid #efefef; } } </style> </head> <body> <noscript>Your browser does not support JavaScript!</noscript> <div id="gradient"></div> <header> <div id="logo"> <a id='logo1' href="/">RJ722</a> <span id='logo2'>#</span> <a id='logo3' href="/blog/"> blog </a> </div> <div id="more-nav"> &rarr; <a href="/blog/" class="selected">blog</a> </div> </header> <h1> <span> Phase-1 of GSoC </span> </h1> <div class="published"> <span>24 June 2017</span> </div> <div id="container"> <div id="content"> <div class="post" id="post-"> <h1 id="so-phase-1-is-coming-to-an-end">So, Phase 1 is coming to an end!</h1> <p>Phase 1 of the coding period ended on 26’th June 23:30 GMT+5:30. With this post, I would like to reflect upon the development progress so far and share some of the challenges I faced.</p> <h2 id="overview">Overview</h2> <p>I had the following things to tackle:</p> <ul> <li>Make vulture available as an API</li> <li>Refactor VultureBear accordingly</li> <li>Add an option to exclude some files from being analysed by vulture</li> <li>Implement confidence values for results given by vulture</li> <li>Make use of the <a href="https://github.com/jendrikseipp/vulture/blob/master/vulture/whitelists/stdlib.py"><code class="highlighter-rouge">stdlib whitelist</code></a> in every run by default.</li> <li>Add appveyor CI</li> </ul> <h3 id="making-vulture-available-as-an-api">Making vulture available as an API</h3> <p>Thanks to the already implemented <code class="highlighter-rouge">Vulture.Item</code> class and <code class="highlighter-rouge">vulture.scavenge</code> method, we had to do <strong>nothing</strong> to extend vulture’s utility as an API. We just had to manipulate the way VultureBear calls vulture.</p> <h3 id="refactor-vulturebear">Refactor VultureBear</h3> <p>Previosuly, VultureBear created a POpen instance, executed vulture over the input files and piped the output. Output was then parsed for information (filename, lineno, type, etc.) using Regular Expressions.</p> <p>You can read more about it here - <a href="/meeting-jendrik">Meeting Jendrik</a></p> <h3 id="add-an-option-to-exclude-files">Add an option to exclude files</h3> <p>There might be a variety of reasons where people would want VultureBear to <em>not</em> analyse some files, like:</p> <ul> <li>vulture reports False positives, and they are fed up of errors.</li> <li>some configuration files define environment variales, they are being reported as dead code by vulture.</li> <li>Author plans to use the specified code later.</li> </ul> <p>Now, previously, I had the vulture’s exclude option in my mind. But, then @jayvdb pointed out that there is an ignore option in coala. After further discussion, the issue was marked as already resolved. :-) Thanks @jayvdb</p> <h3 id="implement-confidence-values-for-results-given-by-vulture">Implement confidence values for results given by vulture</h3> <p>This was an important change, as it would have changed the format in which vulture reports it’s results.</p> <p>In a prior meeting with @jendrikseipp, it was decided that imports would be reported with 100% confidence and everything else with 70%. There was also some discussion for a flag <code class="highlighter-rouge">--min-confidence</code> which would enable a filter which would only allow results which have a confidence more than the value given.</p> <p>But after further thought the idea of making this change upstream was dropped and the <code class="highlighter-rouge">CONFIDENCE_MAP</code> was implemented in the <code class="highlighter-rouge">VultureBear</code> itself. The implementation is quite simple:</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">CONFIDENCE_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'attribute'</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
    <span class="s">'class'</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
    <span class="s">'function'</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
    <span class="s">'import'</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span>
    <span class="s">'property'</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
    <span class="s">'variable'</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">_find_unused_code</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
    <span class="s">"""
    :param filenames: List of filenames to check.
    :return: Generator of Result objects.
    """</span>

    <span class="k">def</span> <span class="nf">file_lineno</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">item</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

    <span class="n">vulture</span> <span class="o">=</span> <span class="n">Vulture</span><span class="p">()</span>
    <span class="n">vulture</span><span class="o">.</span><span class="n">scavenge</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">vulture</span><span class="o">.</span><span class="n">unused_funcs</span> <span class="o">+</span> <span class="n">vulture</span><span class="o">.</span><span class="n">unused_imports</span> <span class="o">+</span>
            <span class="n">vulture</span><span class="o">.</span><span class="n">unused_props</span> <span class="o">+</span> <span class="n">vulture</span><span class="o">.</span><span class="n">unused_vars</span> <span class="o">+</span>
            <span class="n">vulture</span><span class="o">.</span><span class="n">unused_attrs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">file_lineno</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s">'Unused {0}: {1}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">Result</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s">'VultureBear'</span><span class="p">,</span>
                                 <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
                                 <span class="nb">file</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                 <span class="n">line</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span>
                                 <span class="n">confidence</span><span class="o">=</span><span class="n">CONFIDENCE_MAP</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">typ</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">VultureBear</span><span class="p">(</span><span class="n">GlobalBear</span><span class="p">):</span>
    <span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Python'</span><span class="p">,</span> <span class="s">'Python 3'</span><span class="p">}</span>
    <span class="n">REQUIREMENTS</span> <span class="o">=</span> <span class="p">{</span><span class="n">PipRequirement</span><span class="p">(</span><span class="s">'vulture'</span><span class="p">,</span> <span class="s">'0.14.0'</span><span class="p">)}</span>
    <span class="n">AUTHORS</span> <span class="o">=</span> <span class="p">{</span><span class="s">'The coala developers'</span><span class="p">}</span>
    <span class="n">AUTHORS_EMAILS</span> <span class="o">=</span> <span class="p">{</span><span class="s">'coala-devel@googlegroups.com'</span><span class="p">}</span>
    <span class="n">LICENSE</span> <span class="o">=</span> <span class="s">'AGPL-3.0'</span>
    <span class="n">ASCIINEMA_URL</span> <span class="o">=</span> <span class="s">'https://asciinema.org/a/82256'</span>
    <span class="n">CAN_DETECT</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Unused Code'</span><span class="p">}</span>
    <span class="n">SEE_MORE</span> <span class="o">=</span> <span class="s">'https://github.com/jendrikseipp/vulture'</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Check Python code for unused variables and functions using `vulture`.
        """</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">_find_unused_code</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div> <h3 id="default-whitelisting">Default whitelisting</h3> <p>The idea here was to take into account a whitelist - by default in every run. For this, some ground work needed to be layed down first - It seemed like a daunting task at first because it needed a major change in the way vulture was shipped - It had to be shipped as a package, so that we can bundle any additional <em>package data</em> with it - like whitelists.</p> <p>But au contraire this was relatively easy - we just needed to rename some files and change the directory structure.</p> <p>Now, only whitelists needed to be bundled</p> <p>For this, I added this to the <code class="highlighter-rouge">setup.py</code>:</p> <div class="highlighter-rouge"><pre class="highlight"><code>package_data={'vulture': ['whitelists/**/*.py']},
</code></pre></div> <p>But no matter what, an error kept on cramming:</p> <div class="highlighter-rouge"><pre class="highlight"><code>no whitelists/ file were found in the package-dir
</code></pre></div> <p>Now, here comes the confusing part: package_data is not supposed to take up recursive glob patterns and this wasn’t mentioned <strong>anywhere</strong> in the documentation. :-( I found it written in a very small font in some comment on Stack Overflow. Anyways, removing the <code class="highlighter-rouge">**</code> made it work.</p> <p>Finally we could now add whitelists to the list of modules being scanned, @jendrikseipp suggested a much efficient way to append the core whitelist data and I was finally able to merge this PR. :-)</p> <p>Here are the commits:</p> <ul> <li><a href="https://github.com/jendrikseipp/vulture/commit/7e41b08cbc7ef3a4076ee84c749a9a8058ed6e0c">Ship vulture as a package.</a></li> <li><a href="https://github.com/jendrikseipp/vulture/commit/f2c0cf5eb9347e6a983362e80eb029ceb31901d3">Use stdlib.py as a default whitelist</a></li> </ul> <h3 id="add-appveyor-ci">Add appveyor CI</h3> <p>After going through their documentation more than twice, I still had no idea what would be the constructs of the <code class="highlighter-rouge">appveyor.yml</code>(The configuration file for appveyor). Then, it came to me, just copy the file from coala-bears and make suitable changes.</p> <p>Here’s the appveyor file for coala-bears:</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">environment</span><span class="pi">:</span>
  <span class="s">global</span><span class="pi">:</span>
    <span class="c1"># SDK v7.0 MSVC Express 2008's SetEnv.cmd script will fail if the</span>
    <span class="c1"># /E:ON and /V:ON options are not enabled in the batch script intepreter</span>
    <span class="c1"># See: http://stackoverflow.com/a/13751649/163740</span>
    <span class="s">CMD_IN_ENV</span><span class="pi">:</span> <span class="s2">"</span><span class="s">cmd</span><span class="nv"> </span><span class="s">/E:ON</span><span class="nv"> </span><span class="s">/V:ON</span><span class="nv"> </span><span class="s">/C</span><span class="nv"> </span><span class="s">.</span><span class="se">\\</span><span class="s">.ci</span><span class="se">\\</span><span class="s">run_with_env.cmd"</span>

  <span class="s">matrix</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">PYTHON</span><span class="pi">:</span> <span class="s2">"</span><span class="s">C:</span><span class="se">\\</span><span class="s">Python34"</span>
      <span class="s">PYTHON_VERSION</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.4"</span>
      <span class="s">PYTHON_ARCH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">32"</span>

    <span class="pi">-</span> <span class="s">PYTHON</span><span class="pi">:</span> <span class="s2">"</span><span class="s">C:</span><span class="se">\\</span><span class="s">Python34-x64"</span>
      <span class="s">PYTHON_VERSION</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.4"</span>
      <span class="s">PYTHON_ARCH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">64"</span>

<span class="s">cache</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">C:</span><span class="se">\\</span><span class="s">pip_cache"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">node_modules"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">C:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">appveyor</span><span class="se">\\</span><span class="s">AppData</span><span class="se">\\</span><span class="s">Local</span><span class="se">\\</span><span class="s">coala-bears</span><span class="se">\\</span><span class="s">coala-bears"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">C:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">appveyor</span><span class="se">\\</span><span class="s">AppData</span><span class="se">\\</span><span class="s">Roaming</span><span class="se">\\</span><span class="s">nltk_data"</span>

<span class="s">branches</span><span class="pi">:</span>
  <span class="s">except</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/^sils\/.*/</span>

<span class="s">install</span><span class="pi">:</span>
  <span class="c1"># Prepend newly installed Python to the PATH of this build (this cannot be</span>
  <span class="c1"># done from inside the powershell script as it would require to restart</span>
  <span class="c1"># the parent CMD process).</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">SET</span><span class="nv"> </span><span class="s">PATH=%PYTHON%;%PYTHON%</span><span class="se">\\</span><span class="s">Scripts;%PATH%"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">SET</span><span class="nv"> </span><span class="s">PATH=C:</span><span class="se">\\</span><span class="s">Program</span><span class="se">\ </span><span class="s">Files</span><span class="se">\\</span><span class="s">Java</span><span class="se">\\</span><span class="s">jdk1.7.0</span><span class="se">\\</span><span class="s">bin;%PATH%"</span>

  <span class="c1"># language-tool needs the registry tweaked here since it determines the java</span>
  <span class="c1"># version wrong (since appveyor has both, 1.7 and 1.8 in x86 and x64).</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">SET</span><span class="nv"> </span><span class="s">KEY_NAME=HKLM</span><span class="se">\\</span><span class="s">Software</span><span class="se">\\</span><span class="s">JavaSoft</span><span class="se">\\</span><span class="s">Java</span><span class="nv"> </span><span class="s">Runtime</span><span class="nv"> </span><span class="s">Environment"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">REG</span><span class="nv"> </span><span class="s">add</span><span class="nv"> </span><span class="se">\"</span><span class="s">%KEY_NAME%</span><span class="se">\"</span><span class="nv"> </span><span class="s">/v</span><span class="nv"> </span><span class="s">CurrentVersion</span><span class="nv"> </span><span class="s">/t</span><span class="nv"> </span><span class="s">REG_SZ</span><span class="nv"> </span><span class="s">/d</span><span class="nv"> </span><span class="s">1.7</span><span class="nv"> </span><span class="s">/f"</span>

  <span class="c1"># Check that we have the expected version and architecture for Python</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">python</span><span class="nv"> </span><span class="s">--version"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">python</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="se">\"</span><span class="s">import</span><span class="nv"> </span><span class="s">struct;</span><span class="nv"> </span><span class="s">print(struct.calcsize('P')</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">8)</span><span class="se">\"</span><span class="s">"</span>


  <span class="pi">-</span> <span class="pi">&gt;</span>
    <span class="no">"%CMD_IN_ENV% pip install</span>
    <span class="no">--cache-dir=C:\\pip_cache -r requirements.txt -r test-requirements.txt</span>

  <span class="pi">-</span> <span class="s">ps</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Install-Product</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">''"</span>  <span class="c1"># Use latest node v5.x.x</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">npm</span><span class="nv"> </span><span class="s">config</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">loglevel</span><span class="nv"> </span><span class="s">warn"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">npm</span><span class="nv"> </span><span class="s">install"</span>

<span class="s">build</span><span class="pi">:</span> <span class="s">false</span>  <span class="c1"># Not a C# project, build stuff at the test step instead.</span>

<span class="s">test_script</span><span class="pi">:</span>
  <span class="c1"># Force DOS format, as Checkstyle configs enable NewlineAtEndOfFile,</span>
  <span class="c1"># which defaults to CRLF on Windows, and Appveyor CI ignores .gitattributes</span>
  <span class="c1"># http://help.appveyor.com/discussions/problems/5687-gitattributes-changes-dont-have-any-effect</span>
  <span class="pi">-</span> <span class="s">unix2dos tests/java/test_files/CheckstyleGood.java</span>
  <span class="c1"># Clang DLLs x64 were nowadays installed, but the x64 version hangs, so we</span>
  <span class="c1"># exclude according tests. See https://github.com/appveyor/ci/issues/495 and</span>
  <span class="c1"># https://github.com/appveyor/ci/issues/688</span>
  <span class="pi">-</span> <span class="pi">&gt;</span>
    <span class="no">"%CMD_IN_ENV% python -m pytest</span>
    <span class="no">--cov -k "not ClangASTPrintBear and not ClangCloneDetectionBear and</span>
    <span class="no">not ClangComplexityBear and not ClangCountVectorCreator and</span>
    <span class="no">not ClangCountingConditions"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">%CMD_IN_ENV%</span><span class="nv"> </span><span class="s">python</span><span class="nv"> </span><span class="s">setup.py</span><span class="nv"> </span><span class="s">install"</span>

<span class="s">on_success</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">codecov</span>

<span class="s">on_failure</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">codecov</span>

<span class="s">matrix</span><span class="pi">:</span>
  <span class="s">fast_finish</span><span class="pi">:</span> <span class="s">true</span>
</code></pre></div> <p>After tweaking around a little bit, it looked like this:</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">environment</span><span class="pi">:</span>
  <span class="s">global</span><span class="pi">:</span>
    <span class="c1"># SDK v7.0 MSVC Express 2008's SetEnv.cmd script will fail if the</span>
    <span class="c1"># /E:ON and /V:ON options are not enabled in the batch script intepreter</span>
    <span class="c1"># See: http://stackoverflow.com/a/13751649/163740</span>
    <span class="s">CMD_IN_ENV</span><span class="pi">:</span> <span class="s2">"</span><span class="s">cmd</span><span class="nv"> </span><span class="s">/E:ON</span><span class="nv"> </span><span class="s">/V:ON</span><span class="nv"> </span><span class="s">/C</span><span class="nv"> </span><span class="s">.</span><span class="se">\\</span><span class="s">.ci</span><span class="se">\\</span><span class="s">run_with_env.cmd"</span>


  <span class="s">matrix</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">PYTHON</span><span class="pi">:</span> <span class="s2">"</span><span class="s">C:</span><span class="se">\\</span><span class="s">Python34"</span>
      <span class="s">PYTHON_VERSION</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.4"</span>
      <span class="s">PYTHON_ARCH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">32"</span>

    <span class="pi">-</span> <span class="s">PYTHON</span><span class="pi">:</span> <span class="s2">"</span><span class="s">C:</span><span class="se">\\</span><span class="s">Python34-x64"</span>
      <span class="s">PYTHON_VERSION</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.4"</span>
      <span class="s">PYTHON_ARCH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">64"</span>

<span class="s">cache</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">C:</span><span class="se">\\</span><span class="s">pip_cache"</span>

<span class="s">install</span><span class="pi">:</span>
  <span class="c1"># Prepend newly installed Python to the PATH of this build (this cannot be</span>
  <span class="c1"># done from inside the powershell script as it would require to restart</span>
  <span class="c1"># the parent CMD process).</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">SET</span><span class="nv"> </span><span class="s">PATH=%PYTHON%;%PYTHON%</span><span class="se">\\</span><span class="s">Scripts;%PATH%"</span>

  <span class="c1"># Check that we have the expected version and architecture for Python</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">python</span><span class="nv"> </span><span class="s">--version"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">python</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="se">\"</span><span class="s">import</span><span class="nv"> </span><span class="s">struct;</span><span class="nv"> </span><span class="s">print(struct.calcsize('P')</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">8)</span><span class="se">\"</span><span class="s">"</span>


  <span class="pi">-</span> <span class="pi">&gt;</span>
    <span class="no">"%CMD_IN_ENV% pip install</span>
    <span class="no">--cache-dir=C:\\pip_cache tox</span>

<span class="s">build</span><span class="pi">:</span> <span class="s">false</span>  <span class="c1"># Not a C# project, build stuff at the test step instead.</span>

<span class="s">test_script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="pi">&gt;</span>
    <span class="no"># tox takes care of everything, from installing to running tests and even reporting the code coverage</span>
    <span class="no">"%CMD_IN_ENV% tox</span>

<span class="s">matrix</span><span class="pi">:</span>
  <span class="s">fast_finish</span><span class="pi">:</span> <span class="s">true</span>

</code></pre></div> <p>But, sadly, this didn’t work. :-( But then, an option called <code class="highlighter-rouge">Ignore YAML</code> caught my eye - This meant there was another way to do this - It was the helper GUI in appveyor and then, I thought, I would export all the settings in the form of the YAML file. Browsing through every setting and after 10 failed builds, when the eleventh one finally finished successfully, I was all set to celebrate. :-)</p> <p>Here’s what the current <code class="highlighter-rouge">appveyor.yml</code> file looks like:</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">version</span><span class="pi">:</span> <span class="s">1.0.{build}</span>

<span class="s">install</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">cmd</span><span class="pi">:</span> <span class="s">pip install tox</span>

<span class="s">build_script</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">cmd</span><span class="pi">:</span> <span class="s">python setup.py install</span>

<span class="s">test_script</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">cmd</span><span class="pi">:</span> <span class="s">tox</span>

<span class="s">matrix</span><span class="pi">:</span>
  <span class="s">fast_finish</span><span class="pi">:</span> <span class="s">true</span>

</code></pre></div> <p>I was finally able to get things to work in the given time. Here’s how my Burndown chart looks like for the Phase 1: <img src="https://user-images.githubusercontent.com/15556382/27702696-7b5eb3b4-5d22-11e7-9a72-38863baad16d.png" alt="screen shot 2017-06-29 at 11 25 47 pm" /></p> <p>Special thanks to @jendrikseipp and @jayvdb. <strong>Thank You! :-)</strong></p> <div id="more"> <div id="more-articles"> <p> If you liked this, feel free to <a href="/blog">browse other articles on my blog</a>. </p> </div> <a href="https://twitter.com/rahul722j" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @rahul722j</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> <a href="https://twitter.com/share" class="twitter-share-button" data-via="rahul722j" data-size="large">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> </div> </div> </div> </div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="/assets/js/comments.js"></script> <link rel="preload" href="/assets/css/code.css" as="style" onload="this.rel='stylesheet'"> <script> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); /*! loadCSS rel=preload polyfill. [c]2017 Filament Group, Inc. MIT License */ !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); </script> <footer> <div>Website powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a>, hosted on <a href="https://github.com/RJ722/rj722.github.io">Github</a> and put together by <a href="http://twitter.com/marcgg">@marcgg</a>.</div> <div>All of the <a href="/blog">blog's articles</a> are under <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative commons</a> license unless stated otherwise. Everything else is &copy;.</div> </footer> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-31071519-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>

